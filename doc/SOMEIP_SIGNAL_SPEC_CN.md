# logmgrd SOME/IP 信号规范

---

## 1. 总述

logmgrd 通过 SOME/IP 协议接收远程日志上传请求，并在处理完成后返回处理结果信号。本文档详细规范了信号值、流程、网络参数及错误处理，供集成与开发人员参考。

---

## 2. 网络参数

- 协议：SOME/IP（demo 版为 TCP 实现）
- 服务器监听 IP：可配置，默认 0.0.0.0（全部网卡）
- 服务器监听端口：30501
- 字节序：网络字节序（大端 Big Endian）
- 通信方式：一次请求一次响应，短连接

---

## 3. 信号定义

### 3.1 上传请求信号

- 信号名称：日志上传请求
- 信号数值：`0xAABBCCDD`（4 字节）
- 负载内容：无，仅 4 字节信号
- 发送方：远程客户端
- 说明：客户端连接 logmgrd 后发送该信号，触发日志归档与上传流程

### 3.2 处理结果响应信号

logmgrd 完成归档和上传后，主动连接回客户端并发送如下 4 字节响应信号：

| 信号名称   | 数值           | 说明                |
|------------|----------------|---------------------|
| 成功       | 0x00000000     | 日志归档与上传成功  |
| FTP 错误   | 0xFFFFFFFF     | FTP 上传失败        |
| 归档错误   | 0xFFFFFFFE     | 日志归档失败        |
| 其他错误   | 0xFFFFFFFD     | 其他/未指定错误     |

**注意：信号均为 4 字节，采用网络字节序。**

---

## 4. 消息格式

- 请求：4 字节信号值（无负载）
- 响应：4 字节信号值（无负载）
- 字节序：大端（network byte order）

#### 示例（十六进制）：

- 上传请求：`AA BB CC DD`
- 成功响应：`00 00 00 00`

---

## 5. 通信流程

1. 客户端连接 logmgrd 监听端口（30501）。
2. 客户端发送 4 字节上传请求信号（0xAABBCCDD）。
3. logmgrd 读取信号后关闭连接，开始归档和上传操作。
4. 操作完成后，logmgrd 主动连接回客户端（使用原连接的 IP 和端口），发送 4 字节响应信号。
5. logmgrd 关闭连接。

---

## 6. 错误处理

- 归档或上传失败时，发送对应错误信号。
- logmgrd 不自动重试，客户端可按需自行重试。
- 所有错误会记录在 logmgrd 的本地日志文件。

---

## 7. 安全建议

- 建议通过防火墙限制端口访问范围，避免未授权访问。
- 协议本身无身份认证机制，生产环境应配合网络安全措施。

---

## 8. 扩展说明

- 预留信号值请避开已定义数值，便于后续协议扩展。
- 后续可扩展自定义负载（如日志类型、指定子路径等）。

---